@if(!gameStarted()){
  <div class="start-screen">
    <div class="start-card">
      <h1 class="logo">Millionaire</h1>
      <p>Welcome challenger. Take a seat in the hot chair and see how far you can go.</p>
      <button class="btn start-btn" (click)="startGame()" [disabled]="startLoading()">
        {{ startLoading() ? 'Loading...' : 'Start Game' }}
      </button>
    </div>
  </div>
} @else {
  <div class="app-shell" [class.no-chat]="!showChat()">
    <div class="header">
      <h1 class="logo">Millionaire</h1>
    </div>

    <div class="chat-column">
      <button class="btn toggle-chat" (click)="toggleChat()">
        {{ showChat() ? 'Hide Chat' : 'Show Chat' }}
      </button>
      @if(showChat()) {
        <section class="chat">
          <header>Twitch Chat</header>
          <div class="messages" id="chatbox">
            @for(m of getLastHundred(); track m) {
              <div class="msg">
                <b>{{m.user}}:</b> {{m.text}}
              </div>
            }
          </div>
          <footer>Connected as anonymous to <b>#{{getChannel()}}</b></footer>
        </section>
      }
    </div>

    <section class="stage">
      <div class="board">
        <div class="controls">
          <button class="btn" (click)="use5050()" [disabled]="is50Used()">50/50</button>
          <button class="btn" (click)="askAudience()" [disabled]="isAudienceUsed()">Ask the Audience</button>
          <button class="btn" (click)="phoneFriend()" [disabled]="isPhoneUsed()">Phone a Friend</button>
        </div>

        <div class="question">{{currentQuestion()?.prompt}}</div>

        <div class="answers">
          @for(key of keys; track key) {
            <button class="answer"
              [class.disabled]="hidden.value.includes(key) || getLocked()"
              [class.correct]="lastResult()==='correct' && (currentQuestion()?.correct===key)"
              [class.incorrect]="lastResult()==='incorrect' && (currentQuestion()?.correct!==key)"
              (click)="prepareAnswer(key)">
              <span class="label">{{label(key)}}</span>
              <span>{{currentQuestion() ? currentQuestion()!.answers[key] : ''}}</span>
            </button>
          }
        </div>
      </div>

      <aside class="ladder">
        <ol>
          @for(m of moneyLadder; track m) {
            <li [class.active]="(moneyLadder.length-1-$index)===getCurrent()">
              <span>{{moneyLadder.length-$index}}</span>
              <span>{{m}}</span>
            </li>
          }
        </ol>
      </aside>
    </section>

    @if(showAudience()){
      <app-lifeline-audience (closed)="closeAudience()"></app-lifeline-audience>
    }
    @if(showPhone()){
      <app-phone-friend (closed)="closePhone()"></app-phone-friend>
    }
    @if(status()==='won'){
      <div class="modal result-modal">
        <div class="modal-card result-card victory">
          <h2>Congratulations!</h2>
          <p>You answered all 15 questions and won {{moneyLadder[0]}}.</p>
          <div class="result-actions">
            <button class="btn" (click)="restartGame()">Play Again for some reason</button>
          </div>
        </div>
      </div>
    }
    @if(status()==='lost'){
      <div class="modal result-modal">
        <div class="modal-card result-card defeat">
          <h2>Game Over</h2>
          <p>That wasn't the right answer. You made it to question {{getCurrent()+1}}.</p>
          <div class="result-actions">
            <button class="btn" (click)="restartGame()">Try Again</button>
            <button class="btn ghost" (click)="continueAsLoser()">Continue Anyway (Loser)</button>
          </div>
        </div>
      </div>
    }

    @if(finalConfirmOpen()){
      <div class="modal confirm-modal">
        <div class="modal-card confirm-card">
          <h2>Is that your final answer?</h2>
          @if(pendingAnswer()){
            <p>You picked <b>{{label(pendingAnswer()!)}}</b> {{currentQuestion() ? currentQuestion()!.answers[pendingAnswer()!] : ''}}</p>
          }
          <div class="result-actions">
            <button class="btn" (click)="confirmFinalAnswer()">Yes, lock it in</button>
            <button class="btn ghost" (click)="cancelFinalAnswer()">No, let me think</button>
          </div>
        </div>
      </div>
    }
  </div>
}
